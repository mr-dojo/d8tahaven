# ============================================================================
# Personal Data Collector (PDC) - Environment Configuration
# ============================================================================
#
# Instructions:
# 1. Copy this file to .env:  cp .env.example .env
# 2. Fill in your API keys and adjust settings as needed
# 3. Never commit .env to version control (it's in .gitignore)
#
# ============================================================================

# ============================================================================
# Environment
# ============================================================================
ENVIRONMENT=development  # development, production, test
LOG_LEVEL=INFO           # DEBUG, INFO, WARNING, ERROR
DEBUG=false

# ============================================================================
# API Configuration
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=true  # Auto-reload on code changes (development only)

# API Security
API_KEY=your-secret-api-key-here-change-me  # Used by browser plugin
CORS_ORIGINS=http://localhost:3000,http://localhost:8000  # Comma-separated

# ============================================================================
# Database (PostgreSQL + pgvector)
# ============================================================================
DATABASE_URL=postgresql://pdc_user:pdc_password@localhost:5432/pdc
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10
DATABASE_ECHO=false  # Set to true to log all SQL queries (development only)

# ============================================================================
# Message Queue & Cache (Redis + Celery)
# ============================================================================
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# Celery Configuration
CELERY_TASK_TIME_LIMIT=300  # Max task duration (seconds)
CELERY_TASK_SOFT_TIME_LIMIT=270  # Soft limit before hard kill
CELERY_WORKER_CONCURRENCY=4  # Number of worker processes
CELERY_TASK_ACKS_LATE=true
CELERY_TASK_REJECT_ON_WORKER_LOST=true

# ============================================================================
# LLM Providers
# ============================================================================

# Anthropic (Claude) - For enrichment tasks
ANTHROPIC_API_KEY=sk-ant-api03-...your-key-here
ANTHROPIC_BASE_URL=https://api.anthropic.com  # Optional: custom endpoint

# Model Selection
CLAUDE_HAIKU_MODEL=claude-haiku-3-5-20241022  # Fast tasks
CLAUDE_SONNET_MODEL=claude-sonnet-4-5-20250929  # Complex tasks

# OpenAI - For embeddings
OPENAI_API_KEY=sk-...your-key-here
OPENAI_BASE_URL=https://api.openai.com/v1  # Optional: custom endpoint
OPENAI_EMBEDDING_MODEL=text-embedding-3-small  # 1536 dimensions

# LLM Request Configuration
LLM_REQUEST_TIMEOUT=60  # Timeout for LLM API calls (seconds)
LLM_MAX_RETRIES=3
LLM_RETRY_DELAY=2  # Initial delay between retries (exponential backoff)

# ============================================================================
# Enrichment Configuration
# ============================================================================

# Feature Flags (enable/disable stages)
ENRICHMENT_ENABLED=true
INTELLIGENCE_ENABLED=false  # Progressive enhancement (optional)

# Enrichment Tasks (enable/disable individual tasks)
ENRICHMENT_CLASSIFICATION_ENABLED=true
ENRICHMENT_KEYWORDS_ENABLED=true
ENRICHMENT_THEMES_ENABLED=true
ENRICHMENT_SUMMARIZATION_ENABLED=true
ENRICHMENT_EMBEDDINGS_ENABLED=true
ENRICHMENT_RELATIONSHIPS_ENABLED=true

# Content Processing
MAX_CONTENT_LENGTH=100000  # Max characters per capture
MAX_FILE_SIZE_MB=10  # Max upload file size
CHUNK_SIZE=1000  # Characters per chunk for long content

# ============================================================================
# Retrieval Configuration
# ============================================================================

# Context Packaging
DEFAULT_MAX_TOKENS=4000  # Default token budget for context packaging
DEFAULT_CONTEXT_FORMAT=markdown  # markdown, json
DEFAULT_RECENCY_WEIGHT=0.7  # How much to favor recent items (0.0-1.0)
ENABLE_DEDUPLICATION=true

# Search Configuration
VECTOR_SEARCH_LIMIT=50  # Initial candidates for semantic search
SIMILARITY_THRESHOLD=0.7  # Minimum cosine similarity (0.0-1.0)

# ============================================================================
# Intelligence Configuration (Progressive Enhancement)
# ============================================================================

# Weekly Synthesis
SYNTHESIS_ENABLED=false
SYNTHESIS_SCHEDULE="0 9 * * MON"  # Cron: Every Monday at 9 AM
SYNTHESIS_LOOKBACK_DAYS=7

# Theme Trends
TRENDS_ENABLED=false
TRENDS_SCHEDULE="0 10 * * MON"  # Cron: Every Monday at 10 AM
TRENDS_WINDOW_DAYS=30

# Gap Identification
GAPS_ENABLED=false
GAPS_SCHEDULE="0 11 * * MON"  # Cron: Every Monday at 11 AM
GAPS_THRESHOLD_DAYS=30  # No activity for this many days = gap

# ============================================================================
# Performance & Limits
# ============================================================================

# Rate Limiting
RATE_LIMIT_CAPTURE=100  # Requests per minute per API key
RATE_LIMIT_RETRIEVAL=50  # Requests per minute per API key

# Performance Targets
CAPTURE_TARGET_MS=100  # Target response time
RETRIEVAL_TARGET_MS=500  # Target response time

# Queue Management
MAX_QUEUE_DEPTH=1000  # Alert if queue exceeds this
QUEUE_DEPTH_CHECK_INTERVAL=60  # Check every N seconds

# ============================================================================
# Monitoring & Observability
# ============================================================================

# Structured Logging
LOG_FORMAT=json  # json, console
LOG_FILE=logs/pdc.log  # Empty to disable file logging

# Metrics
METRICS_ENABLED=true
METRICS_PORT=9090  # Prometheus-compatible metrics endpoint

# Health Checks
HEALTH_CHECK_INTERVAL=30  # Seconds between health checks

# Sentry (Optional Error Tracking)
SENTRY_DSN=  # Leave empty to disable
SENTRY_TRACES_SAMPLE_RATE=0.1

# ============================================================================
# Browser Plugin Configuration
# ============================================================================

# CORS for browser extension
BROWSER_PLUGIN_ENABLED=true
BROWSER_PLUGIN_CORS_ORIGINS=chrome-extension://*,moz-extension://*

# ============================================================================
# Testing Configuration
# ============================================================================

# Test Database (automatically used when ENVIRONMENT=test)
TEST_DATABASE_URL=postgresql://test:test@localhost:5433/pdc_test
TEST_REDIS_URL=redis://localhost:6380/0

# Test Fixtures
USE_MOCK_LLM=false  # Use mocked LLM responses in tests
TEST_DATA_SEED=42  # Random seed for reproducible test data

# ============================================================================
# Development Tools
# ============================================================================

# Hot Reload
WATCHFILES_FORCE_POLLING=false  # Set to true if file watching doesn't work

# Debugging
ENABLE_PROFILER=false  # Enable request profiling
ENABLE_QUERY_LOGGING=false  # Log all database queries

# ============================================================================
# Notes
# ============================================================================
#
# Priority Configuration:
# 1. Environment variables (highest)
# 2. .env file
# 3. Default values in code (lowest)
#
# Security Best Practices:
# - Use strong, unique API keys
# - Rotate keys regularly
# - Never commit .env to version control
# - Use different keys for development/production
# - Restrict API key access with firewall rules
#
# Self-Hosting:
# - All services run locally by default (Docker Compose)
# - Deploy to your own VPS/cloud VM if needed
# - No data leaves your infrastructure except LLM API calls
# - Full control over your data
#
